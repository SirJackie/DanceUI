<!DOCTYPE html>
<html>
    <head>
        <title>c</title>
        <link href="DanceUI.css" rel="stylesheet" type="text/css">
    </head>
    <body>
        <line>
            <dance width="1h" height="1h">h</dance>
            <dance width="1f" height="1h">f</dance>
            <dance width="1f" height="1h">f</dance>
            <dance width="1f" height="1h">f</dance>
            <dance width="1h" height="1h">h</dance>
        </line>
        <script>
            var DanceUI = {
                StandardUnits : {
                    Height   : null,
                    Margin   : null,
                    FontSize : null
                },
                
                CalculateStandardUnits : function(){
                    DanceUI.StandardUnits.Height   = document.documentElement.clientHeight / 10;
                    DanceUI.StandardUnits.Margin   = DanceUI.StandardUnits.Height / 3;
                    DanceUI.StandardUnits.FontSize = DanceUI.StandardUnits.Margin * 2;
                },

                SetStandardUnits : function(){
                    var style = document.createElement("style");
                    style.type = "text/css";
                    try{
                        style.appendChild(document.createTextNode("body{font-size:" + DanceUI.StandardUnits.FontSize + "px;}"));
                        // style.appendChild(document.createTextNode("dance{margin:" + DanceUI.StandardUnits.Margin + "px;}"));
                        // style.appendChild(document.createTextNode("dance{box-shadow:0 0 " + DanceUI.StandardUnits.Margin + "px #777777;"));
                    }catch(ex){
                        //针对IE
                        style.styleSheet.cssText = "body{font-size:" + DanceUI.StandardUnits.FontSize + "px;}dance{margin:" + DanceUI.StandardUnits.Margin + "px;}dance{box-shadow:0 0 " + DanceUI.StandardUnits.Margin + "px #777777;";
                    }
                    var head = document.getElementsByTagName("head")[0];
                    head.appendChild(style);
                },

                DecodeStringUnit : function(str){
                    var resultStr = str.match(/\d+f/);
                    if(resultStr == null){
                        resultStr = str.match(/\d+h/);
                        if(resultStr == null){
                            //出错
                            console.log("DanceUI Error:Cannot get string's unit");
                            console.log("Error String:");
                            console.log(str);
                            return null;
                        }
                        //单位是h
                        return ({
                            num : Math.floor(resultStr[0].substr(0,resultStr[0].length-1)),
                            unit : "h"
                        });
                    }
                    //单位是f
                    return ({
                        num : Math.floor(resultStr[0].substr(0,resultStr[0].length-1)),
                        unit : "f"
                    });
                },

                DecodeComputedStyle : function(str){
                    var resultStr = str.match(/\d+px/);
                    return Math.floor(resultStr[0].substr(0,resultStr[0].length-2));
                },

                GetDanceArea : function(dance){
                    /* 定义areaObj */
                    var areaObj = {
                        width  : null,
                        height : null
                    }

                    /* 获取<dance>标签的宽高属性值 */
                    var danceWidthStr  = dance.getAttribute("width");
                    var danceHeightStr = dance.getAttribute("height");

                    /* 如果<dance>有宽,就获取,否则宽等于1f */
                    if(danceWidthStr == null){
                        areaObj.width = {
                            num  : 1,
                            unit : "f"
                        };
                    }
                    else{
                        areaObj.width = DanceUI.DecodeStringUnit(danceWidthStr);
                    }

                    /* 如果<dance>有高,就获取,否则高等于1h */
                    if(danceHeightStr == null){
                        areaObj.height = {
                            num  : 1,
                            unit : "h"
                        };
                    }
                    else{
                        areaObj.height = DanceUI.DecodeStringUnit(danceHeightStr);
                    }

                    /* 返回areaObj */
                    return areaObj;
                },

                refresh : function(parent, everyFlexPixel){
                    if(parent.tagName == "LINE"){
                        var totalWidth = parent.clientWidth;

                        var totalHPixel = 0;;
                        var totalF = 0;
                        for(var i = 0; i < parent.childNodes.length; i++){
                            if(parent.childNodes[i].tagName == "DANCE"){
                                var areaResult = DanceUI.GetDanceArea(parent.childNodes[i]);
                                if(areaResult.width.unit == "h"){
                                    totalHPixel += areaResult.width.num * DanceUI.StandardUnits.Height;
                                }
                                else if(areaResult.width.unit == "f"){
                                    totalF += areaResult.width.num;
                                }
                            }
                        }

                        for(var i = 0; i < parent.childNodes.length; i++){
                            DanceUI.refresh(parent.childNodes[i], (totalWidth - totalHPixel) / totalF);
                        }
                        return;
                    }
                    else if(parent.tagName == "DANCE"){
                        var computedStyle = getComputedStyle(parent, null);
                        var areaResult = DanceUI.GetDanceArea(parent);
                        var wannawidth;
                        var wannaheight;
                        if(areaResult.width.unit == "h"){
                            wannawidth = (areaResult.width.num * DanceUI.StandardUnits.Height) - (DanceUI.DecodeComputedStyle(computedStyle.marginLeft) + DanceUI.DecodeComputedStyle(computedStyle.marginRight) + DanceUI.DecodeComputedStyle(computedStyle.paddingLeft) + DanceUI.DecodeComputedStyle(computedStyle.paddingRight) + DanceUI.DecodeComputedStyle(computedStyle.borderLeft) + DanceUI.DecodeComputedStyle(computedStyle.borderRight));
                        }
                        else if(areaResult.width.unit == "f"){
                            wannawidth = (areaResult.width.num * everyFlexPixel) - (DanceUI.DecodeComputedStyle(computedStyle.marginLeft) + DanceUI.DecodeComputedStyle(computedStyle.marginRight) + DanceUI.DecodeComputedStyle(computedStyle.paddingLeft) + DanceUI.DecodeComputedStyle(computedStyle.paddingRight) + DanceUI.DecodeComputedStyle(computedStyle.borderLeft) + DanceUI.DecodeComputedStyle(computedStyle.borderRight));
                        }
                        if(areaResult.height.unit == "h"){
                            wannaheight = (areaResult.height.num * DanceUI.StandardUnits.Height) - (DanceUI.DecodeComputedStyle(computedStyle.marginTop) + DanceUI.DecodeComputedStyle(computedStyle.marginBottom) + DanceUI.DecodeComputedStyle(computedStyle.paddingTop) + DanceUI.DecodeComputedStyle(computedStyle.paddingBottom) + DanceUI.DecodeComputedStyle(computedStyle.borderTop) + DanceUI.DecodeComputedStyle(computedStyle.borderBottom));
                        }
                        else if(areaResult.height.unit == "f"){
                            wannaheight = (areaResult.height.num * everyFlexPixel) - (DanceUI.DecodeComputedStyle(computedStyle.marginTop) + DanceUI.DecodeComputedStyle(computedStyle.marginBottom) + DanceUI.DecodeComputedStyle(computedStyle.paddingTop) + DanceUI.DecodeComputedStyle(computedStyle.paddingBottom) + DanceUI.DecodeComputedStyle(computedStyle.borderTop) + DanceUI.DecodeComputedStyle(computedStyle.borderBottom));
                        }
                        parent.style.width = wannawidth + "px";
                        parent.style.height = wannaheight + "px";
                        // console.log(areaResult.width.num * everyFlexPixel);
                        // console.log(wannawidth);
                        // console.log(wannaheight);
                        // console.log(computedStyle.marginLeft + computedStyle.marginRight + computedStyle.paddingLeft + computedStyle.paddingRight + computedStyle.borderLeft + computedStyle.borderRight);
                        
                        for(var i = 0; i < parent.childNodes.length; i++){
                            DanceUI.refresh(parent.childNodes[i], null);
                        }
                        return;
                    }
                    for(var i = 0; i < parent.childNodes.length; i++){
                        DanceUI.refresh(parent.childNodes[i], null);
                    }
                },

                UserWindowOnload : function(){
                    ;
                },

                UserWindowOnresize : function(){
                    ;
                },

                WindowOnload : function(){
                    DanceUI.CalculateStandardUnits();
                    DanceUI.SetStandardUnits();
                    DanceUI.refresh(document.getElementsByTagName("body")[0], null);
                    DanceUI.UserWindowOnload();
                },

                WindowOnresize : function(){
                    DanceUI.refresh(document.getElementsByTagName("body")[0], null);
                    DanceUI.UserWindowOnresize();
                }
            }
            

            window.onload = function(){
                DanceUI.WindowOnload();
            }
            window.onresize = function(){
                DanceUI.WindowOnresize();
            }
        </script>
    </body>
</html>